$('document').ready(function() {
  if ($('body.videos').length) {
    console.log("Page generated by the videos controller.");

    //... video js code here
    var edit = function() {
      $('.edit').click(function(e){
        e.preventDefault();
        $(this).next().css('display','block');
        editComment();
      });
    };
    var editComment = function() {
      $('.edit-comment').click(function(e){
        e.preventDefault();
        var newComment = $(this).prev().val();
        var id = $(this).parent().parent().attr("class");
        var video_id = $('form:eq(0)').attr('class');
        $.ajax({
          type:"PUT",
          url:"/comments/"+id+"",
          data:{id:id,video_id:video_id,comment:newComment}
        }).done(function(data){
          var comment = $(data).find('div.'+id+'');
          $('div.'+id+'').replaceWith(comment);
        });
      });
    };
    var deleteComment = function() {
      $('.comment-delete').click(function(e){
        e.preventDefault();
        var count = parseInt($('.count').text().slice(14)) - 1;
        var id = $(this).data("comment-id");
        var video_id = $('form:eq(0)').attr('class');
        $.ajax({
          type:"DELETE",
          url:"/comments/"+id+"",
          data:{id:id,video_id:video_id}
        }).done(function(){
          $(this).parent().remove();
          $('li.'+id+'').remove();
          $('div.'+id+'').remove();
          $('.count').text("All comments ("+count+")");
        });
      });
    }
    edit();
    deleteComment();
    $('.comment').click(function(e){
      e.preventDefault();
      var count = parseInt($('.count').text().slice(14)) + 1;
      var id = $('form:eq(0)').attr('class');
      var user_id = $('.user_id').val();
      var comment = $('#comment_comment').val();
      $.ajax({
        type:"POST",
        url:"/videos/"+id+"/comments",
        data:{video_id:id,comment:comment,user_id:user_id},
      }).done(function(html){
        var title = $(html).find('.comments').children('li').last();
        var comment = $(html).find('.comments').children('div').last();
        $('.comments').append(title);
        $('.comments').append(comment);
        $('#comment_comment').val("");
        $('.count').text("All comments ("+count+")");
        edit();
        deleteComment();
      });
    });
  }
});